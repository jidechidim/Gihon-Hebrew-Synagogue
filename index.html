<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gihon Hebrew Synagogue</title>
  <link rel="icon" type="image/png" href="public/assets/logo.png">

  <!-- Fonts & CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body data-header="transparent">

  <!-- Injected partials -->
  <div id="__header"></div>

  <!-- ===== Hero ===== -->
  <section class="hero" id="home" aria-label="Hero">
    <picture id="hero-picture"></picture>
    <div class="hero-overlay"></div>
    <div class="container hero-content" id="hero-content"></div>
  </section>

  <!-- ===== Weekly Parsha ===== -->
  <section id="parsha" class="section parsha">
    <div class="container narrow">
      <h1 class="section-title">Weekly Parsha</h1>

      <blockquote class="parsha-quote" cite="#">
        <h3 id="parshaName" class="parsha-title">Loading...</h3>
        <p id="parshaSummary" class="parsha-content" style="font-size:1.1rem; line-height:1.6;">
          Loading Parsha summary...
        </p>
        <footer class="parsha-ref" style="margin-top:1rem;">
          <p id="parshaRefs" class="ref" style="font-weight:600; color:#0077cc; text-decoration:none;">
            Fetching references...
          </p>
        </footer>
      </blockquote>

      <div class="center">
        <a href="./parsha.html" class="btn btn-outline">Go to Parsha</a>
      </div>
    </div>
  </section>

  <!-- ===== Upcoming Events ===== -->
  <section id="events" class="section events">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">Upcoming Events</h2>
        <div class="events-wrapper">
          <div class="cards-3" id="events-cards"></div>
          <div class="see-more-wrapper">
            <a href="./events.html" class="see-more">See More</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Welcome / About ===== -->
  <section id="welcome" class="welcome section bg-light">
    <div class="container split">
      <div class="split-media" id="welcome-image"></div>
      <div class="split-copy" id="welcome-copy"></div>
    </div>
  </section>


  <!-- ===== Latest News ===== -->
  <section id="news" class="section latest">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">Latest from Gihon</h2>

        <div class="latest-wrapper">
          <div class="latest-grid" id="news-grid"></div>
          <div class="see-more-wrapper">
            <a class="see-more" href="./news.html">See More</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Newsletter Section ===== -->
  <section class="newsletter section">
    <div class="container narrow center">
      <h2 class="section-title">Stay Connected</h2>
      <p>Sign up to receive updates on events, parsha readings, and community news.</p>
      <form class="newsletter-form" id="newsletterForm">
        <input type="email" name="email" placeholder="Enter your email address" required>
        <button type="submit" class="btn btn-primary">Subscribe</button>
      </form>
      <p class="form-msg" id="formMsg"></p>
    </div>
  </section>

  <!-- Injected partials -->
  <div id="__footer"></div>

<!-- ===== Scripts ===== -->
<script type="module" src="./js/partials.js"></script>
<script src="./script.js"></script>
<script src="./js/parsha.js"></script>

<script defer>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    // ===== HERO =====
    const homeRes = await fetch("data/home.json");
    const homeData = await homeRes.json();
    const heroPicture = document.getElementById("hero-picture");
    const heroContent = document.getElementById("hero-content");

    heroPicture.innerHTML = `
      <img src="${homeData.hero.image}" alt="${homeData.hero.alt}" class="hero-img">
    `;
    heroContent.innerHTML = `
      <h1>${homeData.hero.title}</h1>
      <p>${homeData.hero.subtitle}</p>
      <a href="${homeData.hero.cta_link}" class="btn btn-primary">${homeData.hero.cta_text}</a>
    `;

    // ===== WELCOME SECTION =====
    const welcomeImage = document.getElementById("welcome-image");
    const welcomeCopy = document.getElementById("welcome-copy");

    if (homeData.welcome) {
      const { title, paragraphs, image, cta_text, cta_link } = homeData.welcome;

      welcomeImage.innerHTML = `<img src="${image}" alt="${title}">`;
      welcomeCopy.innerHTML = `
        <h2>${title}</h2>
        ${paragraphs.map(p => `<p>${p}</p>`).join("")}
        <a class="btn btn-outline" href="${cta_link}">${cta_text}</a>
      `;
    }

    // ===== UPCOMING EVENTS =====
    const eventsRes = await fetch("data/events.json");
    const eventsData = await eventsRes.json();
    const eventsContainer = document.getElementById("events-cards");

    const upcoming = eventsData
      .sort((a, b) => new Date(a.date) - new Date(b.date))
      .slice(0, 3);

    eventsContainer.innerHTML = upcoming.map(ev => `
      <article class="card">
        <img src="${ev.image}" alt="${ev.title}">
        <div class="card-body">
          <h3>${ev.title}</h3>
          <p>${ev.summary}</p>
          <ul class="meta">
            <li><span class="dot"></span> ${new Date(ev.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</li>
            <li><span class="dot"></span> ${new Date(ev.date).toLocaleDateString()}</li>
            <li><span class="dot"></span> ${ev.location}</li>
          </ul>
          <div class="card-actions">
            <a class="btn btn-sm btn-outline" href="register-for-event.html">Register</a>
          </div>
        </div>
      </article>
    `).join("");

    // ===== LATEST NEWS =====
    const newsContainer = document.getElementById("news-grid");
    const newsRes = await fetch("data/news.json");
    const newsData = await newsRes.json();

    if (newsData.length > 0) {
      const featured = newsData[0];
      const thumbnails = newsData.slice(1, 5);

      newsContainer.innerHTML = `
        <article class="feature">
          <a href="news.html">
            <img src="${featured.image}" alt="${featured.title}">
            <div class="feature-meta">
              <h3>${featured.title}</h3>
              <span class="read-more">Read more</span>
            </div>
          </a>
        </article>
        <aside class="thumbs">
          ${thumbnails.map(item => `
            <a class="thumb" href="news.html">
              <img src="${item.image}" alt="${item.title}">
              <span>${item.title}</span>
            </a>
          `).join("")}
        </aside>
      `;
    }
  } catch (err) {
    console.error("Error loading homepage data:", err);
  }
});
</script>

</body>
</html>